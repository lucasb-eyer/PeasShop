// Generated by CoffeeScript 1.6.1
var H, W, conn, connect, item_template, mkitem;

conn = 0;

W = 600;

H = 400;

connect = function() {
  var addr, err, g;
  if (window["WebSocket"] == null) {
    err = "No WebSocket support. Get a better browser!";
    alert(err);
    throw new Error(err);
  }
  g = (window.location.pathname.match(/.*game\/([a-zA-Z0-9]+).*/))[1];
  addr = "ws://" + window.location.host + "/ws?g=" + g;
  conn = new WebSocket(addr);
  conn.onopen = function(evt) {
    return conn.send(g);
  };
  conn.onclose = function(evt) {
    console.log("Connection lost");
    return console.log(evt);
  };
  return conn.onmessage = function(evt) {
    var $arena, $i, i, item, msg, _i, _len, _ref, _results;
    console.log("Message!");
    console.log(evt.data);
    msg = JSON.parse(evt.data);
    switch (msg.type) {
      case 'start':
        ($('#waiting')).hide();
        ($('#game')).show();
        $arena = $('#arena');
        _ref = msg.items;
        _results = [];
        for (i = _i = 0, _len = _ref.length; _i < _len; i = ++_i) {
          item = _ref[i];
          $i = mkitem(item, i);
          $arena.append($i);
          _results.push($i.click(function() {
            return console.log(item);
          }));
        }
        return _results;
        break;
      case 'other_took':
        return $;
    }
  };
};

mkitem = function(item, i) {
  var $i, t;
  $i = $(Mustache.render(item_template, item));
  $i.hide();
  t = (1.1 - +item.speed) * 10000;
  $i.css({
    'margin-left': 600,
    'margin-top': (i % 2) * 200
  });
  $i.delay(i * 2000).show().animate({
    'margin-left': -200
  }, t, 'linear');
  return $i;
};

item_template = "<div class=item>\n    <img src={{img_url}} />\n</div>";
